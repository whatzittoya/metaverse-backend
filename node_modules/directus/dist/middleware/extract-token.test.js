"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const extract_token_1 = __importDefault(require("../../src/middleware/extract-token"));
require("../../src/types/express.d.ts");
let mockRequest;
let mockResponse;
const nextFunction = jest.fn();
beforeEach(() => {
    mockRequest = {};
    mockResponse = {};
    jest.clearAllMocks();
});
test('Token from query', () => {
    mockRequest = {
        query: {
            access_token: 'test',
        },
    };
    (0, extract_token_1.default)(mockRequest, mockResponse, nextFunction);
    expect(mockRequest.token).toBe('test');
    expect(nextFunction).toBeCalledTimes(1);
});
test('Token from Authorization header (capitalized)', () => {
    mockRequest = {
        headers: {
            authorization: 'Bearer test',
        },
    };
    (0, extract_token_1.default)(mockRequest, mockResponse, nextFunction);
    expect(mockRequest.token).toBe('test');
    expect(nextFunction).toBeCalledTimes(1);
});
test('Token from Authorization header (lowercase)', () => {
    mockRequest = {
        headers: {
            authorization: 'bearer test',
        },
    };
    (0, extract_token_1.default)(mockRequest, mockResponse, nextFunction);
    expect(mockRequest.token).toBe('test');
    expect(nextFunction).toBeCalledTimes(1);
});
test('Ignore the token if authorization header is too many parts', () => {
    mockRequest = {
        headers: {
            authorization: 'bearer test what another one',
        },
    };
    (0, extract_token_1.default)(mockRequest, mockResponse, nextFunction);
    expect(mockRequest.token).toBeNull();
    expect(nextFunction).toBeCalledTimes(1);
});
test('Null if no token passed', () => {
    (0, extract_token_1.default)(mockRequest, mockResponse, nextFunction);
    expect(mockRequest.token).toBeNull();
    expect(nextFunction).toBeCalledTimes(1);
});
